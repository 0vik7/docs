# Получение информации о виртуальной машине

Вы можете получить всю основную информацию о виртуальной машине в консоли управления. Чтобы получить пользовательские [метаданные](../../concepts/vm-metadata), воспользуйтесь CLI или API.

Также можно получить основную информацию и метаданные [изнутри виртуальной машины](#inside-instance).

## Получить информацию снаружи виртуальной машины {#outside-instance}

---

**[!TAB Консоль управления]**

В разделе **Compute Cloud** на странице **Виртуальные машины** приводится список виртуальных машин в каталоге с краткой информацией о них.

Для получения более подробной информации о виртуальной машине нажмите на имя машины:
- На вкладке **Обзор** приводится общая информация о виртуальной машине, в том числе IP-адреса, присвоенные машине.
- На вкладке **Диски** приводится информация о дисках, подключенных к виртуальной машине.
- На вкладке **Операции** приводится список операций с виртуальной машиной и подключенными к ней ресурсами, например дисками.
- На вкладке **Мониторинг** приводится информация о нагрузках на виртуальной машине.


**[!TAB CLI]**

Получите основную информацию о виртуальной машине:

```
yc compute instance get <INSTANCE-ID>|<INSTANCE-NAME>
```

Основная информация не включает пользовательские метаданные, которые были переданы при создании или изменении виртуальной машины. Чтобы получить информацию вместе с метаданными используйте флаг `--full`:

```
yc compute instance get --full <INSTANCE-ID>|<INSTANCE-NAME>
```


**[!TAB API]**

Для получения основной информации о виртуальной машине используйте метод `Get` для ресурса `Instance`.

Основная информация не включает пользовательские метаданные, которые были переданы при создании или изменении виртуальной машины. Чтобы получить информацию вместе с метаданными, укажите в параметрах `view=FULL`.

---


## Получить информацию изнутри виртуальной машины {#inside-instance}

Изнутри виртуальной машины сервер [метаданных](../../concepts/vm-metadata.md) доступен по IP-адресу `169.254.169.254`.

На данный момент сервер метаданных Яндекс.Облака возвращает метаданные в форматах [Google Compute Engine]( #gce-metadata) и [Amazon EC2](#ec2-metadata).

### Google Compute Engine {#gce-metadata}

Сервер метаданных Яндекс.Облака позволяет возвращать метаданные в формате Google Compute Engine.

#### Формат запроса

```
GET http://169.254.169.254/computeMetadata/v1/
  ? alt=<json|text>
  & recursive=<true|false>
  & wait_for_change=<true|false>
  & last_etag=<string>
  & timeout_sec=<int>
Metadata-Flavor: Google
```

Параметр | Описание
----- | -----
`alt` | Формат ответа (по умолчанию `text`).
`recursive` | Если `true`, возвращает все значения по дереву рекурсивно. По умолчанию `false`.
`wait_for_change` | Если `true`, ответ будет возвращен только когда один из параметров метаданных изменится. По умолчанию `false`.
`last_etag` | Значение ETag из предыдущего ответа на аналогичный запрос. Используйте при `wait_for_change="true"`.
`timeout_sec` | Максимальное время ожидания запроса. Используйте при `wait_for_change="true"`.

#### Примеры запросов

Узнать идентификатор виртуальной машины изнутри машины:

```
curl -H Metadata-Flavor:Google 169.254.169.254/computeMetadata/v1/id
```

Чтобы получить все элементы метаданных, воспользуйтесь опцией `recursive`:

```
curl -H Metadata-Flavor:Google 169.254.169.254/computeMetadata/v1/?recursive=true
```

Метаданные выводятся в формате JSON в одну строку без форматирования. Чтобы получить их в удобном для чтения формате, воспользуйтесь утилитой [jq](https://stedolan.github.io/jq/):

```
curl -H Metadata-Flavor:Google 169.254.169.254/computeMetadata/v1/?recursive=true | jq -r '.'
```

#### Список возвращаемых элементов

Список элементов, которые доступны по этому запросу.

Элемент | Описание
----- | -----
`attributes/` | Пользовательские метаданные, переданные при создании или изменении виртуальной машины в поле `metadata`.
`attributes/ssh-keys` | Список открытых SSH-ключей, переданных при создании виртуальной машины в поле `metadata` в значении ключа `ssh-keys`.
`description` | Текстовое описание, переданное при создании или изменении виртуальной машины.
`disks/` | Диски, подключенные к виртуальной машине.
`hostname` | [FQDN](../../concepts/network.md#hostname), назначенный виртуальной машине.
`id` | Идентификатор виртуальной машины. ID генерируется автоматически при создании виртуальной машины и уникален в пределах всего Яндекс.Облака.
`name` | Имя, переданное при создании или изменении виртуальной машины.
`networkInterfaces/` | Сетевые интерфейсы, подключенные к виртуальной машине.

Другие элементы, например `project`, используются для обратной совместимости и остаются пустыми.


### Amazon EC2 {#ec2-metadata}

Сервер метаданных Яндекс.Облака позволяет возвращать метаданные в формате Amazon EC2.

#### Формат запроса метаданных

Адрес для запроса:

```
GET http://169.254.169.254/latest/meta-data/<элемент>
```

`<элемент>` — это путь к элементу, который вы хотите получить. Если не задан, в ответе вернется список доступных элементов.

#### Список возвращаемых элементов

> [!NOTE]
>
> В угловых скобках выделены параметры, которые необходимо заменить значениями. Например, вместо <mac> следует подставить MAC-адрес сетевого интерфейса.

Элемент | Описание
----- | -----
`hostname` | Имя хоста, присвоенное виртуальной машине.
`instance-id` | Идентификатор виртуальной машины.
`local-ipv4` | Внутренний IPv4-адрес.
`local-hostname` | Имя хоста, присвоенное виртуальной машине.
`mac` | MAC-адрес сетевого интерфейса виртуальной машины.
`network/interfaces/macs/<mac>/ipv6s` | Внутренние IPv6-адреса, ассоциированные с сетевым интерфейсом.
`network/interfaces/macs/<mac>/local-hostname` | Имя хоста, ассоциированное с сетевым интерфейсом.
`network/interfaces/macs/<mac>/local-ipv4s` | Внутренние IPv4-адреса, ассоциированные с сетевым интерфейсом.
`network/interfaces/macs/<mac>/mac` | MAC-адрес сетевого интерфейса виртуальной машины.
`public-ipv4` | Внешний IPv4-адрес.

#### Примеры запросов

Получить внутренний IP-адрес изнутри виртуальной машины:

```
curl http://169.254.169.254/latest/meta-data/local-ipv4
```