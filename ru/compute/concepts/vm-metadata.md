# Метаданные

Метаданные — сведения о виртуальной машине, которые можно использовать для выполнения некоторых настроек. Эти метаданные можно получить как изнутри виртуальной машины, так и через API Яндекс.Облака.

При создании виртуальной машины вы можете передать собственные метаданные, которые будут использоваться виртуальной машиной при запуске. Например, метаданные можно использовать для доставки открытого ключа SSH на виртуальную машину.

> [!IMPORTANT]
> Метаданные, в том числе пользовательские, хранятся в незашифрованном виде. Каждый, кто имеет возможность подключиться к виртуальной машине, может получить эти данные. Если вы размещаете в метаданных конфиденциальную информацию, примите меры для ее защиты — например, зашифруйте ее самостоятельно. Не используйте метаданные для хранения паролей.

## Доступ к метаданным изнутри

Изнутри виртуальной машины сервис метаданных доступен по IP-адресу `169.254.169.254`. Ваша виртуальная машина автоматически получает доступ к сервису метаданных без дополнительной авторизации.

Адрес для запроса:

```
http://169.254.169.254/latest/meta-data/{элемент}
```

Например, вы можете получить идентификатор виртуальной машины, выполнив на ней следующую команду:

```
curl http://169.254.169.254/latest/meta-data/id
```


## Формат запроса

Адрес для запроса
:   ```
    http://169.254.169.254/latest/meta-data/
    ```

PATH-параметры
:   Параметр | Описание
    ----- | -----
    `alt="<json|text>"` | Формат ответа (по умолчанию `text`).
    `recursive="<true|false>"` | Если `true`, возвращает все значения по дереву рекурсивно. По умолчанию `false`.
    `wait_for_change="<true|false>"` | Если `true`, ответ будет возвращен только когда один из параметров метаданных изменится. По умолчанию `false`.
    `timeout_sec="<int>"` | Максимальное время ожидания запроса. Используйте при `wait_for_change="true"`.

HTTP-заголовок
:   В запросе необходимо указать заголовок
    ```
    Metadata-Flavor: Google
    ```

Список элементов, которые доступны по этому запросу.

## Список элементов

Элемент | Описание
----- | -----
`attributes/` | Путь с пользовательскими метаданными, переданными при создании или изменении виртуальной машины.
`cpu-platform` | CPU platform of the instance.
`description` | Текстовое описание, переданное при создании или изменении виртуальной машины.
`disks/` | Директория, в которой перечисляются диски, подключенные к виртуальной машине..
`hostname` | [Имя хоста](vm.md#hostname), назначенное виртуальной машине.
`id` | ID виртуальной машины. Идентификатор генерируется автоматически при создании виртуальной машины и уникален в пределах всего Яндекс.Облака.
`name` | Имя, переданное при создании или изменении виртуальной машины.
`network-interfaces/` | Директория, в которой перечисляются сетевые интерфейсы, подключенные к виртуальной машине.
`zone` | Зона доступности, в которой запущена виртуальная машина.


## Пользовательские метаданные {#user-data}

Пользовательские метаданные — произвольная строка, которая была передана в элементе `ec2-user-data`. Пользовательские метаданные можно передать при создании или изменении виртуальной машины в API или в интерфейсе командной строки (CLI).

Пользовательские метаданные могут быть использованы различными скриптами для настройки виртуальной машины, например скриптом [cloud-init]( https://cloud-init.io), который есть в большинстве популярных дистрибутивов Linux.

Для использования метаданных скриптом `cloud-init`, метаданные необходимо передать пользовательские метаданные в элементе `ec2-user-data`. Эти метаданные будут доступны из виртуальной машины по следующему адресу:

```
http://169.254.169.254/latest/meta-data/attributes/ec2-user-data
```