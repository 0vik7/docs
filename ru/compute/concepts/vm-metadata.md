# Метаданные виртуальной машины

Каждая виртуальная машина хранит сведения о себе на сервере метаданных. Вы можете запрашивать эти метаданные [изнутри](../operations/vm-info/vm-info.md#inside-instance) виртуальной машины или [снаружи](../operations/vm-info/vm-info.md#outside-instance) с помощью API Яндекс.Облака или интерфейса командной строки (CLI).

Метаданные используются программами, которые запускаются при старте виртуальной машины. Например, чтобы задать список пользователей или указать открытый ключ SSH для подключения к виртуальной машине.

Изнутри виртуальной машины сервер метаданных доступен по IP-адресу `169.254.169.254`.

На данный момент сервер метаданных Яндекс.Облака возвращает метаданные в форматах [Google Compute Engine]( ../operations/vm-info/vm-info.md#gce-metadata) и [Amazon EC2](../operations/vm-info/vm-info.md#ec2-metadata).

## Формат метаданных при создании виртуальной машины

Вы задаете метаданные в виде пар `"ключ":"значение"` в поле `metadata` (значением может быть только строка). Если в значении надо передать несколько строк, разделите их символом переноса строки `\n`.

В CLI еще можно передать значение в виде файла: `--metadata-from-file key=path/to/file`. Таким образом удобнее передать значение из нескольких строк.

Вы можете указывать любые ключи. То, какие ключи необходимо указывать зависит от того, какая программа будет их обрабатывать на вашей виртуальной машине. Например, в образах Linux, предоставляемых Яндекс.Облаком, используется программа cloud-init.

> [!IMPORTANT]
> Метаданные, в том числе пользовательские, хранятся в незашифрованном виде. Каждый, кто имеет возможность подключиться к виртуальной машине, может получить эти данные. Если вы размещаете в метаданных конфиденциальную информацию, примите меры для ее защиты — например, зашифруйте ее самостоятельно.

## Программы, обрабатывающие метаданные в образах Яндекс.Облака {#public-images-metadata}

В публичных образах Linux Яндекс.Облака для настройки виртуальной машины по умолчанию используется [cloud-init](https://cloud-init.io). В публичных образах с Windows — [Cloudbase-Init](https://cloudbase.it/cloudbase-init/).

### Использование cloud-init

Программа cloud-init обрабатывает метаданные, которые были переданы в ключах `user-data` и `ssh-keys`.

#### user-data

Все пользовательские метаданные для `cloud-init` необходимо передать в ключе `user-data`. Есть [несколько форматов](https://cloudinit.readthedocs.io/en/latest/topics/format.html) метаданных, которые поддерживает cloud-init, например `cloud-config`.

Вы можете использовать `user-data`, чтобы передать ключи SSH на виртуальную машину и указать, какому пользователю принадлежит каждый ключ. Для этого передайте их в элементе  `users/ssh_authorized_keys`. Подробнее читайте в разделе [Users and Groups](https://cloudinit.readthedocs.io/en/latest/topics/modules.html#users-and-groups) в документации к `cloud-init`.

Пример метаданных, которые вы можете задать в поле `user-data` в формате cloud-config:

```
#cloud-config
users:
  - name: demo
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh-authorized-keys:
      - ssh-rsa AAAAB3Nza......OjbSMRX user@example.com
      - ssh-rsa AAAAB3Nza......Pu00jRN user@desktop
```

#### ssh-keys

В поле `ssh-keys` тоже можно передавать ключи SSH, но тогда cloud-init обработает только первый ключ SSH из списка. При этом ключ будет присвоен пользователю, который задан в конфигурации cloud-init по умолчанию. В разных образах это разные пользователи.

Если вы не знаете, какой пользователь задан по умолчанию, рекомендуем передавать ключи SSH в `user-data`.
