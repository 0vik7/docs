# Агент для сброса паролей пользователей на виртуальных машинах Windows

Для сброса паролей пользователей на виртуальных машинах Windows {{ yandex-cloud }} предоставляет специальную программу — _агент_, работающий как служба Windows. Агент генерирует для пользователя ВМ новый пароль и безопасно передает его пользователю {{ yandex-cloud }}, запросившему сброс (подробную схему работы агента см. ниже). 


Установить агент для сброса паролей и программу для обновления агента можно по [инструкции](../operations/vm-guest-agent/install.md). В июне 2022 года они войдут в состав стандартных образов Windows.

{% include [password-reset-linux](../../_includes/compute/password-reset-linux.md) %}

Для сброса паролей с помощью агента требуются:

{% include [vm-reset-password-windows-reqs](../../_includes/compute/vm-reset-password-windows-reqs.md) %}

Логи работы агента, в том числе ежеминутные сообщения о его состоянии, доступны на последовательном порте 4 (COM4).

## Как агент сбрасывает пароль {#reset-flow}

Когда пользователь {{ yandex-cloud }} запрашивает сброс пароля:

1. На стороне пользователя (в браузере, если сброс запрошен в консоли управления, или в PowerShell) по алгоритму [RSA](https://ru.wikipedia.org/wiki/RSA) создается пара из открытого и закрытого ключей шифрования. Запрос с открытым ключом и именем пользователя ВМ, для которого нужно сбросить пароль, отправляется агенту через HTTPS-соединение.
1. Агент на ВМ:

   * получает и верифицирует запрос от клиента;
   * генерирует новый пароль;
   * если пользователя ВМ с указанным именем не существует, создает нового с правами администратора;
   * назначает пользователю ВМ сгенерированный пароль;
   * шифрует пароль открытым ключом, полученным в запросе;
   * отправляет пароль пользователю {{ yandex-cloud }} через HTTPS-соединение.

1. На стороне пользователя полученный пароль расшифровывается закрытым ключом и отображается в консоли управления или в PowerShell.

#### См. также {#see-also}

* [Сбросить пароль пользователя ВМ](../operations/vm-control/vm-reset-password.md)
* [Проверить работу агента](../operations/vm-guest-agent/check.md)
* [Установить агент](../operations/vm-guest-agent/install.md)
* [Удалить агент](../operations/vm-guest-agent/uninstall.md)

