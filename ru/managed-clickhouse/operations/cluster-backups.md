# Управление резервными копиями

Вы можете создавать резервные копии и восстанавливать кластеры из имеющихся резервных копий.

## Создать резервную копию {#create-backup}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **[!KEYREF mch-name]**.

2. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

3. Нажмите кнопку **Создать резервную копию**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы создать резервную копию кластера:

1. Посмотрите описание команды CLI для создания резервной копии [!KEYREF CH]:

    ```
    $ [!KEYREF yc-mdb-ch] cluster backup --help
    ```

2. Запросите создание резервной копии, указав имя или идентификатор кластера:

    ```
    $ [!KEYREF yc-mdb-ch] cluster backup my-ch-cluster
    ```

    Имя и идентификатор кластера можно получить со [списком кластеров](cluster-list.md#list-clusters).

---

## Восстановить кластер из резервной копии {#restore}

Восстанавливая кластер из резервной копии, вы создаете новый кластер с данными из резервной копии. Если в облаке не хватает [ресурсов](../concepts/limits.md) для создания такого кластера, восстановиться из резервной копии не получится.

Для нового кластера необходимо задать все параметры, обязательные при создании, кроме типа кластера (резервную копию [!KEYREF CH] не получится восстановить как кластер [!KEYREF PG]).

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **[!KEYREF mch-name]**.

2. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

3. Нажмите значок ![image](../../_assets/dots.svg) для нужной резервной копии, затем нажмите **Восстановить кластер**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы восстановить кластер из резервной копии:

1. Посмотрите описание команды CLI для восстановления кластера [!KEYREF CH]:

    ```
    $ [!KEYREF yc-mdb-ch] cluster restore --help
    ```

2. Получите список доступных резервных копий [!KEYREF CH]-кластеров:

    ```
    $ [!KEYREF yc-mdb-ch] backup list
    
    +--------------------------+----------------------+----------------------+----------------------+
    |            ID            |      CREATED AT      |  SOURCE CLUSTER ID   |      STARTED AT      |
    +--------------------------+----------------------+----------------------+----------------------+
    | c9qlk4v13uq79r9cgcku:... | 2018-11-02T10:08:38Z | c9qlk4v13uq79r9cgcku | 2018-11-02T10:08:37Z |
    | ...                                                                                           |
    +--------------------------+----------------------+----------------------+----------------------+
    ```

3. Запросите создание кластера из резервной копии:

    ```
    $ [!KEYREF yc-mdb-ch] cluster restore \
           --backup-id c9q22suuefrmrp2lrv9f:20181109T101204 \
           --name mynewch \
           --environment=PRODUCTION \
           --network-name [!KEYREF network-name] \
           --host type=clickhouse,zone-id=[!KEYREF zone-id],subnet-id=b0rcctk2rvtr8efcch63 \
           --clickhouse-disk-size 20 \
           --clickhouse-disk-type network-nvme \
           --clickhouse-resource-preset [!KEYREF host-class]
    ```

    В результате будет создан [!KEYREF CH]-кластер со следующими характеристиками:

    * С именем `mynewch`.

    * В окружении `PRODUCTION`.

    * В сети `[!KEYREF network-name]`.

    * С одним хостом класса `[!KEYREF host-class]` в подсети `b0rcctk2rvtr8efcch63`, в зоне доступности `[!KEYREF zone-id]`.

    * С базами данных и пользователями из резервной копии.

    * С сетевым SSD-хранилищем объемом 20 ГБ.


---

## Получить список резервных копий {#list-backups}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **[!KEYREF mch-name]**.

2. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы получить список резервных копий кластеров [!KEYREF CH], доступных в каталоге по умолчанию, выполните команду:

```
$ [!KEYREF yc-mdb-ch] backup list

+----------+----------------------+----------------------+----------------------+
|    ID    |      CREATED AT      |  SOURCE CLUSTER ID   |      STARTED AT      |
+----------+----------------------+----------------------+----------------------+
| c9qv4... | 2018-10-31T22:01:07Z | c9qv4ql6bd4hfo1cgc3o | 2018-10-31T22:01:03Z |
| c9qpm... | 2018-10-31T22:01:04Z | c9qpm90p3pcg71jm7tqf | 2018-10-31T22:01:04Z |
+----------+----------------------+----------------------+----------------------+
```

---

## Получить информацию о резервной копии {#get-backup}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **[!KEYREF mch-name]**.

2. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы получить данные о резервной копии кластера [!KEYREF CH], выполните команду:

```
$ yc [!KEYREF yc-mdb-ch] backup get <идентификатор резервной копии>
```

Идентификатор резервной копии можно получить со [списком резервных копий](#list-backups).

---

