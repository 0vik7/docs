# Identity Server based on Ory Kratos

Приложение для авторизации учетных записей и управления ими, основанное на [Ory Kratos](https://www.ory.sh/docs/kratos/ory-kratos-intro).

Используйте его, если вам необходим готовый к использованию, масштабируемый и отказоустойчивый сервис, который реализует:
* регистрацию и авторизацию пользователей;
* многофакторную аутентификацию пользователей;
* восстановление и верификацию учетных записей;
* хранение и управление профилями пользователей.

## Необходимые платные ресурсы {#paid-resources}

В стоимость ресурсов для приложения входят:

* Плата за постоянно запущенные виртуальные машины (см. [тарифы {{ compute-full-name }}](../compute/pricing.md));
* Плата за вычислительные ресурсы, объем хранилища и резервных копий для кластера {{ PG }} (см. [тарифы {{ mpg-full-name }}](../managed-postgresql/pricing.md));
* Плата за объем входящего трафика, обработанного балансировщиком, и количество сетевых балансировщиков (см. [тарифы {{ network-load-balancer-full-name }}](../network-load-balancer/pricing.md));.
* Плата за количество вызовов функции, вычислительные ресурсы, выделенные для выполнения функции, и исходящий трафик (см. [тарифы {{ sf-full-name }}](../functions/pricing.md));
* Плата за количество вызовов контейнера, вычислительные ресурсы, выделенные для выполнения приложения, и исходящий трафик (см. [тарифы {{ serverless-containers-full-name }}](../serverless-containers/pricing.md));
* Плата за хранение и запрос секретов (см. [тарифы {{ lockbox-full-name }}](../lockbox/pricing.md));
* Плата за количество запросов к API-шлюзу и исходящий трафик (см. [тарифы {{ api-gw-full-name }}](../api-gateway/pricing.md));
* Плата за запись и хранение логов (см. [тарифы {{ cloud-logging-full-name }}](../logging/pricing.md)).

## Перед началом работы {#before-begin}

1. [Получите](../compute/operations/images-with-pre-installed-software/operate.md#creating-ssh-keys) пару SSH-ключей для подключения к виртуальной машине.
1. Получите у почтового провайдера данные для подключения к SMTP-серверу: адрес и порт SMTP-сервера, имя пользователя и пароль для доступа к SMTP-серверу. Эти данные будут использоваться для авторизации в сервисе, который отправляет письма.

## Разверните приложение {#deploy-app}

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором хотите развернуть приложение.
1. Выберите сервис **{{ cloud-apps-name }}**.
1. На панели слева выберите **Магазин приложений**.
1. Выберите **Identity Server based on Ory Kratos** и, если у вас есть доступ к функциональности [Пользовательская сеть в Cloud Functions](../functions/concepts/networking.md#user-network), нажмите кнопку **Использовать**. Иначе нажмите кнопку **Запросить доступ** и в открывшемся окне нажмите кнопку **Отправить заявку**.
1. Укажите:
    * Имя приложения.
    * (опционально) Описание приложения.
    * Сервисный аккаунт с ролью `admin` на каталог или выберите **Автоматически**, чтобы нужный сервисный аккаунт создался при установке приложения. От имени этого сервисного аккаунта будут создаваться ресурсы приложения.
    * Количество виртуальных машин для Ory Kratos API.
    * Имя пользователя, которое будет использоваться для доступа на виртуальные машины по SSH.
    * Публичный SSH-ключ, [который получили ранее](#before-begin).
    * Имя и пароль пользователя, которые будут использоваться для доступа к БД. Имя и пароль пользователя необходимо придумать самостоятельно.
    * Пароль доступа к приватному Ory Kratos API. Пароль необходимо придумать самостоятельно.
    * Адрес и порт SMTP-сервера, имя пользователя и пароль для доступа к SMTP-серверу, [которые получили ранее](#before-begin).
    * Имя и адрес отправителя, которые будут указаны в письмах от Identity Server based on Ory Kratos.
1. Нажмите кнопку **Установить** и дождитесь, пока приложение установится.

Ссылку, по которой доступен Ory Kratos API, можно найти в консоли управления, на странице API-шлюза, в поле **Служебный домен**. По путям `/public`, `/admin` и `/ui` доступны публичный, приватный API и пользовательский интерфейс соответственно.

Конфигурационные файлы Ory Kratos API формируются с помощью [метаданных виртуальной машины](../compute/concepts/vm-metadata.md). Чтобы изменить их, в консоли управления выберите группу виртуальных машин, нажмите **Изменить** и в разделе **Шаблон виртуальной машины** нажмите ![image](../_assets/options.svg) → **Редактировать**.
