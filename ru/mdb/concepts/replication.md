# Репликация

[!KEYREF mdb-short-name] обеспечивает автоматическое и ручное резервное копирование для всех поддерживаемых СУБД.


## [!KEYREF PG]

В кластерах [!KEYREF PG] используется синхронная репликация: результат запроса на запись информации отражается одновременно на хосте-мастере и приоритетной реплике. На остальных репликах кластера данные дублируются асинхронно.

Выбор мастера и синхронной реплики происходит согласно приоритету, который MDB можно установить для конкретного хоста. Кроме этого, вы можете настроить каскадную репликацию, назначив источник репликации для каждого хоста. 

Подробнее о том, как организована репликация в [!KEYREF PG], читайте в [документации СУБД](https://www.postgresql.org/docs/10/static/warm-standby.html).


## [!KEYREF CH]

[!KEYREF mdb-short-name] помогает организовать репликацию для кластеров [!KEYREF CH] из 2 и более хостов с помощью Apache ZooKeeper. Вам нужно только создать таблицы нужного вида — хосты ZooKeeper будут настроены автоматически.

> [!IMPORTANT]
>
> Учтите, что хосты ZooKeeper учитываются при расчете потребления ресурсов и стоимости кластера. По умолчанию хосты ZooKeeper создаются с минимальным [классом БД](../concepts/instance-types.md).

[!KEYREF CH] поддерживает автоматическую репликацию только для таблиц семейства `ReplicatedMergeTree` (см. раздел [Репликация данных](https://clickhouse.yandex/docs/ru/table_engines/replication/) в документации [!KEYREF CH]). Чтобы обеспечить репликацию, вы можете создать такие таблицы на каждой реплике по отдельности или использовать распределенный DDL-запрос.

Чтобы создать таблицу `ReplicatedMergeTree` на определенном хосте [!KEYREF CH], отправьте запрос следующего вида:
```
CREATE TABLE db_01.table_01 (log_date Date, user_name String) \
 ENGINE = ReplicatedMergeTree('/table_01', '{replica}', log_date, (log_date, user_name), 8192);
```

Здесь:

- `db_01` — имя базы данных.
- `table_01` — имя таблицы.
- `/table_01` — путь к таблице в ZooKeeper, обязательно должен начинаться с прямого слэша <q>/</q>.
- `{replica}` — макроподстановка идентификатора хоста.

Чтобы создать реплицируемые таблицы на всех хостах кластера, отправьте распределенный DDL-запрос (описан в [документации [!KEYREF CH]](https://clickhouse.yandex/docs/ru/query_language/queries/#ddl-on-cluster)):
```
CREATE TABLE db_01.table_01 ON CLUSTER 'my_cluster' (log_date Date, user_name String) \
 ENGINE = ReplicatedMergeTree('/table_01', '{replica}', log_date, (log_date, user_name), 8192);
```

Здесь:

- `my_cluster` — имя кластера [!KEYREF mdb-short-name], которое было получено при его [создании](../operations/clickhouse/cluster-create.md).


## [!KEYREF MG]

Кластеры [!KEYREF MG] поддерживает репликацию по умолчанию: если в кластере есть больше 1 активного хоста, среди них автоматически выбирается первичный сервер, обрабатывающий запросы на запись.

Подробнее о том, как организована репликация в [!KEYREF MG], читайте в [документации СУБД](https://docs.mongodb.com/manual/replication/).