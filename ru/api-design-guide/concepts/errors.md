# Обработка ошибок

Если операция завершилась успешно, сервер возвращает клиенту статус OK. Если в ходе выполнения операции возникла ошибка, сервер возвращает сообщение с описанием ошибки.

Для описания ошибок в API используется сообщение [google.rpc.Status](https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto). Данная модель ошибок используется как в gRPC, так и в REST интерфейсах. 

В [таблице](#error-list) можно ознакомиться со списком ошибок, которые поддерживаются в API на данный момент. 

## Формат сообщения об ошибке {#error-message-format}

Сообщение `Status` содержит три поля:

Поле | Описание
----------- | ----------- 
`code` | <b>int32</b></br>gRPC-код ошибки. Доступные коды ошибок определены в [google.rpc.Code](https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto).
`message` |<b>string</b></br>Описание ошибки.
`details` | <b>repeated google.protobuf.Any</b></br>Дополнительные сведения об ошибке. Поле содержит детальную информацию об ошибке, например, какие параметры были указаны некорректно.</br> </br>В [google.rpc.ErrorDetails](https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto) определены типы сообщений, которые используются в данном поле.
 
Ниже представлено gRPC-описание сообщения `Status`:

```protobuf
message Status {
  // gRPC-код ошибки. Доступные значения определены
  // в [google.rpc.Code].
  int32 code = 1;

  // Описание ошибки.
  string message = 2;

  // Детальная информация об ошибке.
  repeated google.protobuf.Any details = 3;
}
```

## Соответствие с HTTP {#http-mapping}

Соответствия gRPC-статусов с HTTP-кодами описаны в [google.rpc.Code](https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto).

Ниже приведен пример ошибки, которую может вернуть сервер в ответ на REST запрос:

```json
{
  "code": 16,
  "message": "Token is invalid or has expired.",
  "details": [
    {
      "@type": "type.googleapis.com/google.rpc.RequestInfo",
      "requestId": "e38e71c3-adc6-4584-98a4-b0f103d55f61"
    }
  ]
}
```

## Список возможных ошибок {#error-list}
HTTP-код | gRPC-код | gRPC-статус | Описание ошибки
----- | ----- | ----- | -----
400 | 3 | INVALID_ARGUMENT | Клиент некорректно указал параметры запроса. Детальная информация представлена в поле `details`.
400 | 9 | FAILED_PRECONDITION | Операция была отклонена, так как система не находится в состоянии, необходимом для выполнения операции.
400 | 11 | OUT_OF_RANGE | Выход за пределы диапазона. Например, поиск или чтение за границами файла.
401 | 16 | UNAUTHENTICATED | Для выполнения операции необходима авторизация.
403 | 7 | PERMISSION_DENIED | Клиент не обладает необходимыми полномочиями для выполнения операции.
404 | 5 | NOT_FOUND | Запрашиваемый ресурс не найден.
409 | 6 | ALREADY_EXISTS | Попытка создать ресурс, который уже существует.
409 | 10 | ABORTED | Операция была прервана из-за конфликта параллельных вычислений, таких как нарушение последовательности команд или прерванная транзакция.
429 | 8 | RESOURCE_EXHAUSTED | Клиент превысил лимит запросов. 
499 | 1 | CANCELLED | Операция была прервана на стороне клиента.
500 | 2 | UNKNOWN | Неизвестная ошибка.
500 | 15 | DATA_LOSS | Необратимая потеря или повреждение данных.
500 | 13 | INTERNAL | Внутренняя ошибка сервера. Ошибка означает, что операция не может быть выполнена из-за технического состояния сервера. Например, из-за нехватки вычислительных ресурсов.
501 | 12 | NOT_IMPLEMENTED | Операция не поддерживается сервисом.
503 | 14 | UNAVAILABLE | Сервис на данный момент недоступен. Следует повторить запрос через несколько секунд.
504 | 4 | DEADLINE_EXCEEDED | Превышено время ожидания ответа от сервера. Для операций, которые изменяют состояние системы, данная ошибка может быть возвращена, даже если операция была успешно завершена. Например, когда ответ от сервера со статусом 200 OK по каким-то причинам был задержан.

  

## Обработка ошибок в асинхронных вызовах {#async-errors}

При вызове асинхронных операций сервер возвращает объект [Operation](operation.md). В случае возникновения ошибки, сообщение `Status` будет добавлено в объект `Operation` в поле `error`.
