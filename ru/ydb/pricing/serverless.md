---
editable: false
---

# Правила тарификации для бессерверного режима {{ ydb-name }}

{% include [currency-choice](../_includes/pricing/currency-choice.md) %}

При использовании бессерверного режима {{ ydb-name }} плата взимается за каждый выполненный к базе данных запрос. Указывать, какие ресурсы требуются для работы, нет необходимости, база данных оперативно адаптируется к изменению пользовательской нагрузки в рамках выделенных пользователю [квот](../concepts/limits.md). Помимо запросов пользователь оплачивает хранимые в {{ ydb-name }} данные на почасовой основе. Дополнительно тарифицируются другие операции, такие как восстановление из резервной копии.
## Из чего складывается стоимость использования бессерверного режима {{ ydb-name }} {#rules}

При работе {{ ydb-name }} в бессерверном режиме вы оплачиваете:

* операции с данными;
* объем хранимых данных, включая служебные данные, например, индексы;
* дополнительные пользовательские операции, такие как восстановление данных из резервной копии.

Дополнительно оплачиваются иные потребляемые ресурсы:

* место, занятое в сервисе {{ objstorage-name }} для хранения резервных копий по требованию;
* объем исходящего трафика из {{ yandex-cloud }} в интернет.

{% include [pricing-gb-size](../_includes/pricing/pricing-gb-size.md) %}

### Операции с данными и единица запроса {#rules-ru}


Бессерверный режим работы {{ ydb-full-name }} поддерживает несколько способов работы с данными:
* Document API — HTTP API, совместимое с Amazon DynamoDB. С помощью этого API можно выполнять операции над документными таблицами.
* YDB API и его реализации в виде [YDB CLI](../quickstart/yql-api/ydb-cli.md) и [YDB SDK](../ydb-sdk/index.md) для [Java](https://github.com/yandex-cloud/ydb-java-sdk), [Python](https://github.com/yandex-cloud/ydb-python-sdk), [Node.js](https://github.com/yandex-cloud/ydb-nodejs-sdk), [PHP](https://github.com/yandex-cloud/ydb-php-sdk) и [Go](https://github.com/yandex-cloud/ydb-go-sdk). С помощью этого API можно выполнять операции над YDB-таблицами.

Для расчета стоимости запросов в {{ ydb-short-name }} используется понятие **единица запроса** (**RU** — request unit). Каждый выполненный запрос в зависимости от его типа, сложности и размера данных приводит к потреблению определенного количества RU. Итоговая стоимость всех выполненных запросов к {{ ydb-short-name }} складывается из стоимости каждого запроса, выраженной в RU.

#### Document API


Стоимость обработки каждого документа при запросе через Document API равна стоимости единицы запроса в RU, умноженной на размер документа в блоках. Размер в блоках равен размеру в байтах, деленному на размер блока и округленному в большую сторону. Запрос несуществующего документа приравнивается к чтению документа размером в 1 блок. Если запрос обрабатывает несколько документов (например, `BatchGetItem`), итоговая стоимость равна сумме стоимостей по каждому документу.

Тип запроса                                                                        | Стоимость единицы | Размер блока   |
---------------------------------------------------------------------------------- | ----------------- | -------------- |
Чтение (`GetItem`, `BatchGetItem`, `Query`, `Scan`)                                        | 1 RU              | 4 КБ           |
Чтение в рамках транзакции (`TransactGetItems`)                                      | 2 RU              | 4 КБ           |
Запись (`PutItem`, `BatchWriteItem`, `UpdateItem`)                                       | 2 RU              | 1 КБ           |
Запись в рамках транзакции (`TransactWriteItems`)                                    | 4 RU              | 1 КБ           |
Удаление (`DeleteItem`)                                                              | 2 RU              | Не применяется |
Работа со схемой базы данных (`CreateTable`, `DeleteTable`, `DescribeTable`, `ListTables`) | 0 RU              | Не применяется |

#### YDB API {#cost-ydb-api}


При выполнении запроса через {{ ydb-short-name }} API используются ресурсы на стороне сервера. Информация о потребленных ресурсах доступна в статистике исполнения запроса.

Для определения стоимости запроса через YDB API вычисляются стоимость использования CPU и стоимость ввода-вывода данных. Из вычисленных значений выбирается максимальное.

* Стоимость использования CPU.

  Суммируется время CPU, затраченное на компиляцию запроса, а также время использования CPU на всех этапах выполнения запроса. Сумма делится на продолжительность одного окна 1,5 мс, округляется в меньшую сторону и переводится в RU по тарифу из таблицы ниже.

  Закешированные запросы повторно не компилируются. Чтобы воспользоваться кешированием, применяйте в запросах `bind variables`, а также включите флаг сохранения плана исполнения запроса в кеше.

* Стоимость ввода-вывода данных.

  Рассчитываются следующие значения:

  * Количество операций чтения с диска. Сравнивается число прочитанных записей и блоков данных, выбирается наибольшее из них. Число блоков вычисляется делением суммы прочитанных байт на размер блока 4 КБ, с округлением вверх.
  * Количество операций записи на диск. Сравнивается число записанных записей и блоков данных, выбирается наибольшее и них. Число блоков вычисляется делением суммы записанных байт на размер блока 1 КБ, с округлением вверх.

  Учитывается ввод-вывод данных в таблицы и индексы. При удалении записей учитывается только их количество.

  Количества операций чтения и записи переводятся в RU по тарифу из таблицы ниже, полученные стоимости складываются.

{% note warning %}

Некоторые преобразования над записями требуют их чтения или удаления перед изменением, это может повлиять на стоимость запроса.

{% endnote %}

Стоимость единиц выполнения запроса в RU:

Оцениваемый параметр | Стоимость |
:--- | :---: |
Одно окно использования CPU | 1 RU
Одна операция чтения | 1 RU
Одна операция записи | 2 RU

Не тарифицируется следующие операции:

* Создание, изменение и удаление схем таблиц.
* Получение описания и списка таблиц.
* Создание и удаление директорий.

{% cut "Пример расчета стоимости запроса" %}

Статистика запроса:

```text
query_phases {
  ...
  table_access {
    ...
    reads {
      rows: 2
      bytes: 16
    }
    ...
  }
  cpu_time_us: 475
  ...
}
query_phases {
  ...
  table_access {
    ...
    updates {
      rows: 2
      bytes: 2456
    }
    ...
  }
  cpu_time_us: 514
  ...
}
compilation {
  ...
  cpu_time_us: 4062
}
process_cpu_time_us: 870
```

Где:

* `query_phases[].cpu_time_us` — время CPU на выполнение запроса в мкс.
* `compilation.cpu_time_us` — время CPU на компиляцию запроса в мкс.
* `process_cpu_time_us` — время CPU на управление взаимодействием в мкс.
* `query_phases[].reads.rows` — число прочитанных записей данных.
* `query_phases[].reads.bytes` — число прочитанных байт данных.
* `query_phases[].updates.rows` — число записанных записей данных.
* `query_phases[].updates.bytes` — число записанных байт данных.

Чтобы получить стоимость использования CPU, сумма времени CPU запроса делится на 1,5 мс, `( 475 + 514 + 4062 + 870 ) / 1500 = 3,95`. Результат округляется в меньшую сторону и переводится в RU:

```text
3 × 1 RU = 3 RU
```

Чтобы получить стоимости ввода-вывода данных:

* Вычисляется количество операций чтения с диска в записях и блоках, из них выбирается максимальное:

  * прочитаны 2 записи, количество операций равно 2;
  * прочитаны 16 байт, `16 / ( 4 × 1024 ) = 0,004`, результат округляется в большую сторону, количество операций равно 1.

  Количество операций чтения равно 2.

* Вычисляется количество операций записи на диск в записях и блоках, из них выбирается максимальное:

  * записаны 2 записи, количество операций равно 2;
  * записаны 2456 байта, `2456 / 1024 = 2,398`, результат округляется в большую сторону, количество операций равно 3.

  Количество операций записи равно 3.

Стоимость ввода-вывода:

```text
2 × 1 RU + 3 × 2 RU = 8 RU
```

Стоимость выполнения запроса равна 8 RU.

{% endcut %}

##### Особенности расчета стоимости некоторых операций

* **ReadTable**
   Операция `ReadTable` позволяет эффективно вычитывать большие диапазоны данных таблицы. Стоимость запроса зависит только от объема прочитанных данных и составляет 128 RU за 1 МБ. При расчете стоимости объем округляется в большую сторону до значения, кратного 1 МБ.

* **BulkUpsert**
   `BulkUpsert` позволяет эффективно загружать данные в базу. Стоимость записи строки в рамках операции `BulkUpsert` составляет 0,5 RU за 1 КБ записанных данных. При расчете стоимости объем данных округляется в большую сторону до значения, кратного 1 КБ. Итоговая стоимость операции рассчитывается как сумма стоимости всех записанных строк с округлением до ближайшего большего целого.

   **Пример расчета стоимости**

   Например, в рамках операции `BulkUpsert` вы записываете четыре строки данных объемом 2500 байт, 100 байт, 1200 байт и 1024 байта.

   Стоимость такой операции составит:
   > 0,5 RU × 3 + 0,5 RU × 1 + 0,5 RU × 2 + 0,5 RU × 1 = 3,5 RU
   >
   > Итого, после округления в большую сторону: 4 RU

   Где:
   * 0,5 — стоимость в единицах запросов за 1 КБ записанных данных.
   * 3 — объем первой строки в КБ после округления в большую сторону (2500 байт = 1024 байта + 1024 байта + 452 байта).
   * 1 — объем второй строки в КБ после округления в большую сторону.
   * 2 — объем третьей строки в КБ после округления в большую сторону (1200 байт = 1024 байта + 176 байт).
   * 1 — объем четвертой строки в КБ.

* **Построение вторичного индекса**
   Стоимость построения индекса складывается из стоимости операции `ReadTable` оригинальной таблицы и `BulkUpsert` в индексную таблицу. Тарифицируется объем проделанной работы — количество строк и их размер, который был прочитан из оригинальной таблицы и записан в индексную таблицу. Процесс построения индекса может быть отменен пользователем. Отмененные операции построения индекса также тарифицируются за объем проделанной работы до отмены операции.


### Объем хранимых данных {#rules-storage}


В бессерверном режиме мощности для хранения данных выделяются автоматически. Объем хранимых данных при этом рассчитывается как совокупный объем пользовательских и служебных данных, которые хранятся в БД. Например, создание глобального индекса приводит к увеличению размера хранилища на размер такого индекса.

### Создание резервных копий {#rules-backup-storage}


#### Автоматические резервные копии {#rules-auto-backup-storage}

{{ ydb-name }} автоматические создает и бесплатно хранит 2 полные резервные копии ваших баз за два последних дня. Плата за хранение автоматических резервных копий не взимается.

#### Резервные копии по требованию {#rules-auto-backup-storage}

Вы можете принудительно выполнить резервное копирование базы данных с сохранением копии в сервисе {{ objstorage-full-name }}. Стоимость такой операции зависит от объема скопированных данных. При расчете стоимости фактический объем округляется в большую сторону до значений, кратных 1 ГБ.

{% note warning %}

В случае выгрузки данных при помощи утилиты ```ydb tools dump``` тарификация производится по тарифам операции `ReadTable`.

{% endnote %}

### Восстановление из резервной копии {#rules-backup-restore}


Вы можете восстанавливать базы и/или отдельные таблицы из резервных копий, которые хранятся в сервисе {{ objstorage-name }}. Стоимость такой операции зависит от объема восстановленных данных. При расчете стоимости фактический объем округляется в большую сторону до значения, кратного 1 ГБ.

{% note warning %}

В случае восстановления данных при помощи утилиты ```ydb tools restore``` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% endnote %}

## Скидка за резервируемый объем ресурсов {#cvos}


Вы можете получить гарантированную скидку за потребление ресурсов сервиса, запланированное на месяц, на год или на три года вперед.

Бессерверный режим {{ ydb-name }} предоставляет [CVoS](../../billing/concepts/cvos.md) на определенное количество запросов, выраженных в единицах RU, в секунду. Вы можете выбирать размер резерва с шагом 100 RU/с.

При вычислении реального объема потребления количество запросов усредняется каждые пять минут. То есть, например, при резерве 100 RU/с не обязательно потреблять каждую секунду 100 RU. На протяжении интервала усреднения нагрузка может изменяться и составлять в один момент 150 RU/с, в другую — 50 RU/с.

## Цены {#prices}


{% include notitle [rub-serverless](../../_pricing/ydb/rub-serverless.md) %}




{% include notitle [rub-egress-traffic.md](../../_pricing/rub-egress-traffic.md) %}





