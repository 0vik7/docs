# Вторичные индексы

Индекс по первичному ключу в {{ ydb-short-name }} создается автоматически, поэтому выборки с условием по первичному ключу всегда выполняются эффективно и затрагивают только требуемые строки. Выборка с условием, наложенным на одну или несколько неключевых колонок, как правило приводит к полному сканированию таблицы. Для того, чтобы такие выборки были эффективными, нужно использовать вторичные индексы.

{% note alert %}

Автоматическая поддержка вторичных индексов на данный момент не реализована. Для каждой таблицы {{ ydb-short-name }} позволяет определить только один индекс, который строится по первичному ключу. Конструкция ```CREATE INDEX``` пока не поддерживается. Реализация поддержки автоматических вторичных индексов ожидается в следующих версиях {{ ydb-short-name }}.

{% endnote %}

При помощи [распределённых транзакций](transactions.md) в {{ ydb-short-name }} можно сэмулировать вторичные индексы на уровне пользовательского приложения.

Для эмуляции вторичного индекса потребуется создать дополнительную таблицу, в которой первичный ключ будет составлен из одного или нескольких столбцов основной таблицы, по значениями которых планируется искать, а в других полях — значения столбцов, составляющих первичный ключ основной таблицы.

Более подробно вышеописанный подход рассмотрен в разделе [#T](../best_practices/secondary_indexes.md).

### Примеры вторичных индексов {#sk-examples}

В зависимости от свойств индексируемых данных можно выделить несколько типов вторичных индексов:

* уникальные вторичные индексы;
* неуникальные вторичные индексы;
* вторичные индексы для сортировки.

#### Уникальные вторичные индексы {#sk-examples-unique}

Уникальный вторичный индекс не только позволяет быстро искать по неключевым колонкам, но и при вставках измененных данных проверять условие на уникальность значений в определённых полях в рамках всей таблицы. Использование подхода, описанного в данном разделе, хорошо подходит для уникальных вторичных индексов.

#### Неуникальные вторичные индексы {#sk-examples-non-unique}

Разные множества индексируемых значений имеют разные отношения количества элементов с неодинаковыми значениями к общему количеству элементов. Например, у множества всех значений `фамилия + имя + отчество + полная дата рождения` всех жителей города отношение количества неодинаковых значений к общему количеству значений будет высоким, близким к 1. Для множества значений атрибута пол для всех жителей города отношение неодинаковых значений к общему количеству значений будет низким, близким к 0.

При построении вторичных индексов уровня приложения стоит использовать способ с индексной таблицей для множеств индексируемых значений, в которых количество неодинаковых элементов не меньше 5% от общего количества значений.

#### Вторичные индексы для сортировки {#sk-examples-sorting}

Так как строки таблицы в {{ ydb-short-name }} хранятся отсортированными по возрастанию значений первичного ключа, вторичные индексы можно использовать для формирования результатов с сортировкой по произвольному полю таблицы. Например, для выборки топ-10 самых просматриваемых результатов.