# Управление резервными копиями

Вы можете создавать резервные копии и восстанавливать кластеры из имеющихся резервных копий.


## Восстановить кластер из резервной копии {#restore}

Восстанавливая кластер из резервной копии, вы создаете новый кластер с данными из резервной копии. Если в каталоге не хватает [ресурсов](../concepts/limits.md) для создания такого кластера, восстановиться из резервной копии не получится.

Для нового кластера необходимо задать все параметры, обязательные при создании, кроме типа кластера (резервную копию [!KEYREF CH] не получится восстановить как кластер [!KEYREF PG]).

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **Yandex Managed Databases**.
1. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.
1. Нажмите значок ![](../../_assets/dots.svg) для нужной резервной копии, затем нажмите **Восстановить кластер**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы восстановить кластер из резервной копии:

1. Посмотрите описание команды CLI для восстановления кластера [!KEYREF PG]:

    ```
    $ [!KEYREF yc-mdb-pg] cluster restore --help
    ```

1. Получите список доступных резервных копий [!KEYREF PG]-кластеров:

    ```
    $ [!KEYREF yc-mdb-pg] backup list
    
    +--------------------------+----------------------+----------------------+----------------------+
    |            ID            |      CREATED AT      |  SOURCE CLUSTER ID   |      STARTED AT      |
    +--------------------------+----------------------+----------------------+----------------------+
    | c9qlk4v13uq79r9cgcku:... | 2018-11-02T10:08:38Z | c9qlk4v13uq79r9cgcku | 2018-11-02T10:08:37Z |
    | ...                                                                                           |                          |
    +--------------------------+----------------------+----------------------+----------------------+
    ```
    
    Вы можете восстановить [!KEYREF PG]-кластер на любой момент после создания резервной копии (время в столбце `CREATED AT`). 

1. Запросите создание кластера из резервной копии:

    ```
    $ [!KEYREF yc-mdb-pg] cluster restore \
           --backup-id c9qlk4v13uq79r9cgcku:base_000000010000000000000002 \
           --time 2018-11-02T10:09:38Z \
           --name mynewpg \
           --environment=PRODUCTION \
           --network-name default-net \
           --host zone-id=ru-central1-c,subnet-id=b0rcctk2rvtr8efcch63 \
           --disk-size 20 \
           --disk-type network-nvme \
           --resource-preset s1.nano
    ```

    В результате будет создан [!KEYREF PG]-кластер со следующими характеристиками:
    
    - С именем `mynewpg`.
    - В окружении `PRODUCTION`.
    - В сети `default-net`.
    - С одним хостом класса `s1.nano` в подсети `b0rcctk2rvtr8efcch63`, в зоне доступности `ru-central1-c`.
    - С базами данных и пользователями из резервной копии.
    - С сетевым SSD-хранилищем объемом 20 ГБ.

---


## Создать резервную копию {#create-backup}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **Yandex Managed Databases**.
1. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.
1. Нажмите кнопку **Создать резервную копию**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы создать резервную копию кластера:

1. Посмотрите описание команды CLI для создания резервной копии [!KEYREF PG]:

    ```
    $ [!KEYREF yc-mdb-pg] cluster backup --help
    ```
1. Запросите создание резервной копии, указав имя или идентификатор кластера:

    ```
    $ [!KEYREF yc-mdb-pg] cluster backup my-pg-cluster
    ```
    
    Имя и идентификатор кластера можно получить со [списком кластеров](cluster-list.md#list-clusters). 
    
---


## Получить список резервных копий {#list-backups}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **Yandex Managed Databases**.
1. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы получить список резервных копий кластеров [!KEYREF PG], доступных в каталоге по умолчанию, выполните команду:

```
$ [!KEYREF yc-mdb-pg] backup list

+----------+----------------------+----------------------+----------------------+
|    ID    |      CREATED AT      |  SOURCE CLUSTER ID   |      STARTED AT      |
+----------+----------------------+----------------------+----------------------+
| c9qv4... | 2018-10-31T22:01:07Z | c9qv4ql6bd4hfo1cgc3o | 2018-10-31T22:01:03Z |
| c9qpm... | 2018-10-31T22:01:04Z | c9qpm90p3pcg71jm7tqf | 2018-10-31T22:01:04Z |
+----------+----------------------+----------------------+----------------------+
```

---


## Получить информацию о резервной копии {#get-backup}

---

**[!TAB Консоль управления]**

1. Перейдите на страницу каталога и нажмите плитку **Yandex Managed Databases**.
1. Нажмите на имя нужного кластера и выберите вкладку **Резервные копии**.

**[!TAB CLI]**

[!INCLUDE [cli-install](../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../_includes/default-catalogue.md)]

Чтобы получить данные о резервной копии кластера [!KEYREF PG], выполните команду:

```
$ [!KEYREF yc-mdb-pg] backup get <идентификатор резервной копии>
```

Идентификатор резервной копии можно получить со [списком резервных копий](#list-backups).

---
